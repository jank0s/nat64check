{% extends 'v6score/base.html' %}

{% load static %}

{% block content %}
    <h1 class="detail"><a href="{% url 'overview' %}">
        nat64<span>check</span>
    </a></h1>

    <div class="details-header">
        <b>{{ measurement.hostname }}</b>

        <div class="retest">
            <form method="post" action="{% url 'overview' %}">
                {% csrf_token %}
                <input type="hidden" name="url" value="{{ url }}">
                <input type="hidden" name="force_new" value="1">

                <button class="retest-button"><span class="fa fa-check"></span> Test again</button>
            </form>
        </div>

        <div class="last-test">
            Last test:<br>
            <b>{{ measurement.finished|date:"j F Y, H:i T"|default:"Never" }}</b>
        </div>
    </div>

    <div class="detail-main">
        {% if measurement.finished %}
            {% if measurement.v6only_score >= 0 or measurement.nat64_score >= 0 %}
                <table class="measurement">
                    <tr>
                        <th colspan="3">
                            Image match
                        </th>
                    </tr>
                    <tr>
                        <th class="top">
                            NAT64
                            {% if measurement.nat64_image_score == 0 or measurement.nat64_image_score is None %}
                                <div class="image-score poor"><span class="fa fa-bolt fa-lg"></span></div>
                            {% elif measurement.nat64_image_score < 0.8 %}
                                <div class="image-score poor">{% widthratio measurement.nat64_image_score 1 100 %}%</div>
                            {% elif measurement.nat64_score < 0.95 %}
                                <div class="image-score mediocre2">{% widthratio measurement.nat64_image_score 1 100 %}%</div>
                            {% else %}
                                <div class="image-score good">{% widthratio measurement.nat64_image_score 1 100 %}%</div>
                            {% endif %}
                        </th>
                        <th class="top">
                            IPv4-only
                        </th>
                        <th class="top">
                            IPv6-only
                            {% if measurement.v6only_image_score == 0 or measurement.v6only_image_score is None %}
                                <div class="image-score poor"><span class="fa fa-bolt fa-lg"></span></div>
                            {% elif measurement.v6only_image_score < 0.8 %}
                                <div class="image-score poor">{% widthratio measurement.v6only_image_score 1 100 %}%</div>
                            {% elif measurement.v6only_score < 0.95 %}
                                <div class="image-score mediocre2">{% widthratio measurement.v6only_image_score 1 100 %}%</div>
                            {% else %}
                                <div class="image-score good">{% widthratio measurement.v6only_image_score 1 100 %}%</div>
                            {% endif %}
                        </th>
                    </tr>
                    <tr>
                        {% spaceless %}
                            <td class="image">
                                {% if measurement.v4only_image and measurement.nat64_image %}
                                    <img alt="IPv4-only" src="{{ measurement.v4only_image.url }}">
                                    <a class="overlay" href="{{ measurement.nat64_image.url }}" target="_blank"
                                       title="Difference between IPv4-only and NAT64">
                                        <img class="blend-on-hover" alt="NAT64" src="{{ measurement.nat64_image.url }}">
                                    </a>
                                {% elif measurement.nat64_image %}
                                    <a href="{{ measurement.nat64_image.url }}" target="_blank">
                                        <img alt="NAT64" src="{{ measurement.nat64_image.url }}">
                                    </a>
                                {% else %}
                                    <img alt="No IPv4-only" src="{% static 'img/no-image.png' %}">
                                {% endif %}
                            </td>
                            <td class="image">
                                {% if measurement.v4only_image %}
                                    <a href="{{ measurement.v4only_image.url }}" target="_blank">
                                        <img alt="IPv4-only" src="{{ measurement.v4only_image.url }}">
                                    </a>
                                {% else %}
                                    <img alt="No IPv4-only" src="{% static 'img/no-image.png' %}">
                                {% endif %}
                            </td>
                            <td class="image">
                                {% if measurement.v4only_image and measurement.v6only_image %}
                                    <img alt="IPv4-only" src="{{ measurement.v4only_image.url }}">
                                    <a class="overlay" href="{{ measurement.v6only_image.url }}" target="_blank"
                                       title="Difference between IPv4-only and IPv6-only">
                                        <img class="blend-on-hover" alt="IPv6-only"
                                             src="{{ measurement.v6only_image.url }}">
                                    </a>
                                {% elif measurement.v6only_image %}
                                    <a href="{{ measurement.v6only_image.url }}" target="_blank">
                                        <img alt="IPv6-only" src="{{ measurement.v6only_image.url }}">
                                    </a>
                                {% else %}
                                    <img alt="No IPv6-only" src="{% static 'img/no-image.png' %}">
                                {% endif %}
                            </td>
                        {% endspaceless %}
                    </tr>
                </table>
            {% endif %}
        {% else %}
            <script type="application/javascript">
                setTimeout(function () {
                    document.location.reload();
                }, 2500);
            </script>
        {% endif %}



        <h2>Measurement #{{ measurement.pk }}</h2>

        {% include 'v6score/measurement_data.html' with measurement=measurement %}

        <br>

        <a href="{% url 'overview' %}">Back to overview</a>
    </div>
{% endblock %}
